const path=require("path"),os=require("os"),fs=require("fs"),childProcess=require("child_process");var macOS={dirFirst:!0,sortFunction:null,filterFunction:null,lastError:"",lastOutput:"",getExtension:function(e){return path.extname(e)},getConfigDir:function(){return this.appendPath(this.getHomeDir(),".config/modalfilemanager")},terminalScript:"bin/openTerminal.scpt",init:function(){this.sortFunction=this.alphaSort,this.filterFunction=this.defaultFilter},getDirFirst:function(){return dirFirst},setDirFirst:function(e){"boolean"==typeof e&&(this.dirFirst=e)},setDirSort:function(e){this.sortFunction=e},setFilter:function(e){this.filterFunction=e},getTerminalScript:function(){return this.appendPath(this.getHomeDir(),this.terminalScript)},setTerminalScript:function(e){this.terminalScript=e},getHomeDir:function(){return os.homedir()},pathSep:()=>path.sep,readDir:function(e){return"object"==typeof e&&(e=this.appendPath(e.dir,e.name)),fs.readdirSync(this.preserveQuotes(e))},dirExists:function(e){return void 0!==e.name&&(e=this.appendPath(e.dir,e.name)),this.fileExists(this.preserveQuotes(e))},fileExists:function(e){var t=!0;"object"==typeof e&&(e=this.preserveQuotes(this.appendPath(e.dir,e.name)));try{fs.accessSync(e),t=!0}catch(e){t=!1}return t},makeDir:function(e){void 0!==e.name&&(e=this.appendpath(e.dir,e.name)),fs.mkdirSync(this.preserveQuotes(e))},preserveQuotes:function(e){return e.replaceAll(/(\"|\'|\`)/gi,"\\$1")},moveEntries:function(e,t){var i=this.preserveQuotes(e.fileSystem.appendPath(e.dir,e.name)),r=this.preserveQuotes(t.dir),s=this;childProcess.exec("mv '"+i+"' '"+r+"'",(e,t)=>{e&&(s.lastError=e),s.lastOutput=t})},copyEntries:function(e,t,i,r){void 0===i&&(i=!1);var s=this.preserveQuotes(e.fileSystem.appendPath(e.dir,e.name)),n=this.preserveQuotes(t.dir);i&&(n=this.preserveQuotes(t.fileSystem.appendPath(t.dir,t.name)));var o=this;void 0===r?childProcess.exec("cp -R '"+s+"' '"+n+"'",(e,t)=>{e&&(o.lastError=e),o.lastOutput=t}):childProcess.exec("cp -R '"+s+"' '"+n+"'",r)},deleteEntries:function(e){var t=this.preserveQuotes(e.fileSystem.appendPath(e.dir,e.name)),i=this;childProcess.exec("rm -R '"+t+"'",(e,t)=>{e&&(i.lastError=e),i.lastOutput=t})},getDirList:function(e){var t=[];if("object"==typeof e&&void 0!==e.name&&(e=this.appendPath(e.dir,e.name)),this.dirExists(e)){for(var i=fs.readdirSync(e),r=0;r<i.length;r++)if(void 0!==i[r]){var s,n="";i[r][0]==path.sep&&(i[r]=i[r].slice(1)),n=e!=path.sep&&e.length>1?e+path.sep+i[r]:path.sep+i[r];try{var o=fs.statSync(n)}catch(t){s={name:i[r],dir:e,fileSystemType:"macOS",fileSystem:this,selected:!1,datetime:"",type:0,size:0,stats:null}}s={name:i[r],dir:e,fileSystemType:"macOS",fileSystem:this,selected:!1,datetime:o.mtime.toLocaleString(),type:0,size:0,stats:o},o.isDirectory()?(s.type=1,s.size=0):o.isSymbolicLink()?(s.type=2,s.size=o.size):(s.type=0,s.size=o.size),t.push(s)}if(t=t.filter(this.filterFunction),this.dirFirst){var a=t.filter(e=>1===e.type),c=t.filter(e=>0===e.type);a.sort(this.sortFunction),c.sort(this.sortFunction),t=[...a,...c]}else t.sort(this.sortFunction)}return t},defaultFilter:function(e){return"."!==e.name[0]},alphaSort:function(e,t){const i=e.name.toLowerCase(),r=t.name.toLowerCase();return i===r?0:i>r?1:-1},openFile:function(e,t){childProcess.execSync("/usr/bin/open '"+this.appendPath(e,t)+"'")},openFileWithProgram:function(e,t){childProcess.exec("/usr/bin/open -a '"+e+"' '"+t+"'",(e,t,i)=>{})},openInTerminal:function(e,t){childProcess.exec("/usr/bin/osascript "+this.terminalScript+" '"+e+' "'+t+"\"'",(e,t,i)=>{})},runCommandLine:function(e,t){void 0===t?childProcess.exec(e,(e,t,i)=>{}):childProcess.exec(e,t)},appendPath:function(e,t){return"object"==typeof e&&(e=this.appendPath(e.dir,e.name)),e==path.sep?path.sep+t:e[e.length-1]===path.sep?e+t:e+path.sep+t},getStats:function(e){return fs.statSync(e)},readFile:function(e){return"objct"==typeof e&&(e=this.appendPath(e.dir,e.name)),fs.readFileSync(e)},writeFile:function(e,t){"object"==typeof e&&(e=this.appendPath(e.dir,e.name)),fs.writeFileSync(e,t)},renameEntry:function(e,t){var i=this.preserveQuotes(e.fileSystem.appendPath(e.dir,e.name)),r=this.preserveQuotes(t.fileSystem.appendPath(t.dir,t.name));childProcess.execSync('mv "'+i+'" "'+r+'"')},createFile:function(e){var t=this.preserveQuotes(e.fileSystem.appendPath(e.dir,e.name));childProcess.execSync('touch "'+t+'"')},createDir:function(e){var t=this.preserveQuotes(e.fileSystem.appendPath(e.dir,e.name));childProcess.execSync('mkdir "'+t+'"')},loadJavaScript:function(e){var t="",i=this.readFile(e).toString();try{t=new Function("",i)()}catch(e){console.log(e),this.lastError=e.toString(),t=null}return t},searchDir:function(e,t,i,r){try{""===t&&(t=this.pathSep()),""!==e&&childProcess.exec("/usr/local/bin/fd -i --max-results "+i+' -t d "'+e+'" "'+t+'"',(e,t)=>{e?(console.log(e),this.lastError=e.toString()):r(t.toString().split("\n"))})}catch(e){console.log(e),this.lastError=e.toString()}}};export default macOS;